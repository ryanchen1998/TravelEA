@import play.mvc.Http.Request
@(destinationId: Long, loggedUser: models.User, canModify: Boolean)

@scripts = {
    <script src="@routes.Assets.at("javascripts/destinations.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/detailedDestination.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/common/baguetteBox.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("javascripts/common/jquery.bootpag.min.js")" type="text/javascript"></script>
    <script src="@controllers.backend.routes.PhotoController.photoRoutes()" type="text/javascript"></script>
    <script src="@controllers.backend.routes.DestinationController.destinationRoutes()" type="text/javascript"></script>
    <script src="@controllers.backend.routes.ProfileController.profileRoutes()" type="text/javascript"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDCyC_ON0GgSmJIfPlL7oke5PZgbR8TLbg"></script>
}

@layouts.main("Destination", loggedUser, scripts){
    <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/detailedDestination.css")">
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/baguetteBox.min.css")">
    <link rel="stylesheet" href="@routes.Assets.at("stylesheets/gallery-grid.css")">

    @* The custom title section with background image *@
    <div class="title-frame" id="title-frame" style="pointer-events: all !important;">
        <div class="title-bg" id="map"></div>
        <div class="title-text-wrap" style="pointer-events: none !important;">
            <p id="summary_name" class="title-text"></p>
        </div>
    </div>

    <body style="margin:auto">
        <div class="row destination" id="startchange">
            <div class="col-12 col-md-3">
                @* Destination Details *@
                <div id="destination-summary">
                    <div class="destination-details">
                        <div style="padding-bottom: 10px">
                            <span id="destination_name" class="destination_name h1" style="display: inline"></span>
                            @if(canModify) {
                                <div style="display: inline; padding-left: 5px" id="privacy_wrapper"></div>
                            }
                        </div>
                        <p class="heading">Type <span id="summary_type" class="destination-info"></span></p>
                        <p class="heading">District <span id="summary_district" class="destination-info"></span></p>
                        <p class="heading">Country <span id="summary_country" class="destination-info"></span></p>
                        <p class="heading">Latitude <span id="summary_latitude" class="destination-info"></span></p>
                        <p class="heading">Longitude <span id="summary_longitude" class="destination-info"></span></p>
                        @if(canModify) {
                            <p class="heading"></p>
                            <a data-toggle="modal" data-target="#editDestinationModal" onclick="populateEditDestination(@destinationId)">
                                <span class="destination-button" style="float: left; padding-top: 15px; padding-bottom: 0px;">Edit Destination</span>
                            </a>
                            <a data-toggle="modal" data-target="#deleteDestinationModal">
                                <span class="destination-button" style="float: left; padding-top: 10px; color: red; clear: left">Delete Destination</span>
                            </a>
                        }
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-9">
                @* Body Content *@
                <div class="destination-main">
                    <div>
                        <div class="section-title">
                            <p>
                            <span class="section-title">Destination Photos</span>
                                <a class="button-secondary" id="upload-gallery-image-button" >
                                    <span class="destination-button" style="float: right; padding-left:10px;">Link Photo</span>
                                </a>
                                <input id="upload-gallery-image-file" type="file" onchange='uploadNewGalleryPhoto("@controllers.backend.routes.PhotoController.upload()")'
                                accept="image/jpeg, image/png" style="display: none;" multiple/>
                            </p>
                        </div>
                        @* Photo Gallery *
                        @*Gallery modal, false as we want no titles and no add photo button*@
                        @modules.gallery(false, false, "main-gallery", "page-selection")
                    </div>
                </div>
            </div>
        </div>
    </body>

    @* Edit Destination Modal *@
    <div class="modal fade" id="editDestinationModal" role="dialog" data-show="true" aria-labelledby="modalLabel" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Edit Destination</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div>
                    <form id="editDestinationForm">
                        <div class="modal-body mx-3">
                            <div>Name
                                <em class="fas prefix grey-text"></em>
                                <input type="text" name="name" id="name" class="form-control validate" required>
                                <label id="nameError" class="error-messages"></label>
                            </div>

                            <div>Type
                                <em class="fas prefix grey-text"></em>
                                <input type="text" name="_type" id="_type" class="form-control validate" required>
                                <label id="_typeError" class="error-messages"></label>
                            </div>

                            <div>District
                                <em class="fas prefix grey-text"></em>
                                <input type="text" name="district" id="district" class="form-control validate" required>
                                <label id="districtError" class="error-messages"></label>
                            </div>

                            <div>Latitude
                                <em class="fas prefix grey-text"></em>
                                <input type="number" name="latitude" id="latitude" class="form-control validate" pattern="[0-9]+([\.,][0-9]+)?" step="any" required>
                                <label id="latitudeError" class="error-messages"></label>
                            </div>

                            <div>Longitude
                                <em class="fas prefix grey-text"></em>
                                <input type="number" name="longitude" id="longitude" class="form-control validate" pattern="[0-9]+([\.,][0-9]+)?" step="any" required>
                                <label id="longitudeError" class="error-messages"></label>
                            </div>

                            <div>Country
                                <em class="fas prefix grey-text"></em>
                                <select id="countryDropDown" name="countryId" class="form-control validate">
                                </select>
                                <label id="countryError" class="error-messages"></label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex justify-content-center">
                    <button class="btn btn-popup" id="remove-all" data-dismiss="modal">
                        Cancel<em class="fas fa-paper-plane-o ml-1"></em>
                    </button>
                    <button class="btn btn-popup" onclick="editDestination(@destinationId)">
                        Confirm changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    @* Delete Destination Modal *@
    <div class="modal fade" id="deleteDestinationModal" role="dialog" data-show="true" aria-labelledby="modalLabel" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Delete Destination</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <br>
                <div>
                    <p align="center">Are you sure you want to delete this destination?</p>
                </div>
                <div class="modal-footer d-flex justify-content-center">
                    <button class="btn btn-popup" id="remove-all" data-dismiss="modal">
                        No<em class="fas fa-paper-plane-o ml-1"></em>
                    </button>
                    <button class="btn btn-danger" onclick="deleteDestination(@destinationId, '@controllers.frontend.routes.DestinationController.index()')">
                        Yes
                    </button>
                </div>
            </div>
        </div>
    </div>
    @*Link Photo to Destination Modal*@
    <div class="modal fade" id="linkPhotoToDestinationModal" tabindex="-1" role="dialog" data-show="true" aria-labelledby="modalLabel">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Link Photo to Destination</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                @* all images gallery *@
                @modules.gallery(false, false, "link-gallery", "link-selection")
            </div>
        </div>
    </div>


    @* Make Destination Public Modal *@
    <div class="modal fade" id="makeDestinationPublicModal" role="dialog" data-show="true" aria-labelledby="modalLabel" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h4 class="modal-title w-100 font-weight-bold">Make Destination Public</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <br>
                <div>
                    <p align="center">Are you sure you want to make this destination Public? This cannot be undone.</p>
                </div>
                <div class="modal-footer d-flex justify-content-center">
                    <button class="btn btn-popup" id="remove-all" data-dismiss="modal">
                        No<em class="fas fa-paper-plane-o ml-1"></em>
                    </button>
                    <button class="btn btn-primary" onclick="makeDestinationPublic(@destinationId)">
                        Yes
                    </button>
                </div>
            </div>
        </div>
    </div>

}

@*Calling javascript functions for auto-populating the nationality and traveller type selection lists in the filter*@
<script type="text/javascript">
        sendUserIdAndFillGallery(@loggedUser.id, @destinationId);
        fillCountryInfo("@controllers.backend.routes.DestinationController.getAllCountries()");
        populateDestinationDetails(@destinationId);
        initMap(@destinationId);
        src="@controllers.backend.routes.DestinationController.destinationRoutes()"
</script>